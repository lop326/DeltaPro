<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Método de Jacobi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 2rem;
            background-color: #f8f9fa;
        }
        .matrix-input {
            width: 80px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Método de Jacobi</h1>

        <!-- Selección del tamaño de la matriz -->
        <div class="mb-3">
            <label for="size" class="form-label">Número de incógnitas (n):</label>
            <input type="number" id="size" class="form-control" min="2" max="10" value="3">
            <button class="btn btn-primary mt-2" onclick="generarCampos()">Generar Matriz</button>
        </div>

        <!-- Formulario dinámico -->
        <form id="jacobiForm" onsubmit="resolverJacobi(event)">
            <div id="matrizContainer" class="mb-3"></div>
            <div class="mb-3">
                <label for="error" class="form-label">Error permitido:</label>
                <input type="text" id="error" class="form-control" placeholder="Ej: 0.001" required>
            </div>
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="forzar">
                <label class="form-check-label" for="forzar">Forzar ejecución si no es diagonalmente dominante</label>
            </div>
            <button type="submit" class="btn btn-success">Resolver</button>
        </form>

        <!-- Resultados -->
        <div id="resultado" class="mt-4"></div>
    </div>

    <script src="../static/scripts/Jacobi.js"></script> <!-- Tu archivo con metodoJacobi.js -->
    <script>
        function generarCampos() {
            const size = parseInt(document.getElementById("size").value);
            const contenedor = document.getElementById("matrizContainer");
            contenedor.innerHTML = "";

            const tabla = document.createElement("table");
            tabla.classList.add("table", "table-bordered");

            for (let i = 0; i < size; i++) {
                const fila = document.createElement("tr");
                for (let j = 0; j < size; j++) {
                    const td = document.createElement("td");
                    const input = document.createElement("input");
                    input.type = "number";
                    input.className = "form-control matrix-input";
                    input.name = `A-${i}-${j}`;
                    input.placeholder = `A[${i + 1}][${j + 1}]`;
                    td.appendChild(input);
                    fila.appendChild(td);
                }

                // Vector b
                const tdB = document.createElement("td");
                const inputB = document.createElement("input");
                inputB.type = "number";
                inputB.className = "form-control matrix-input";
                inputB.name = `b-${i}`;
                inputB.placeholder = `b[${i + 1}]`;
                tdB.appendChild(inputB);
                fila.appendChild(tdB);

                tabla.appendChild(fila);
            }

            contenedor.appendChild(tabla);
        }

        function resolverJacobi(event) {
            event.preventDefault();

            const size = parseInt(document.getElementById("size").value);
            const A = [];
            const b = [];
            const error = document.getElementById("error").value;
            const forzar = document.getElementById("forzar").checked;

            for (let i = 0; i < size; i++) {
                const fila = [];
                for (let j = 0; j < size; j++) {
                    const val = document.querySelector(`[name="A-${i}-${j}"]`).value;
                    fila.push(parseFloat(val));
                }
                A.push(fila);
                b.push(parseFloat(document.querySelector(`[name="b-${i}"]`).value));
            }

            try {
                const [resultado, iteraciones] = metodoJacobi(A, b, error, forzar);
                document.getElementById("resultado").innerHTML = `
                    <div class="alert alert-success">
                        <strong>✅ Solución encontrada en ${iteraciones} iteraciones:</strong><br>
                        <code>[${resultado.map(x => x.toFixed(6)).join(", ")}]</code>
                    </div>`;
            } catch (err) {
                document.getElementById("resultado").innerHTML = `
                    <div class="alert alert-danger">
                        ${err.message}
                    </div>`;
            }
        }
    </script>
</body>
</html>
